# Autopilot ä¸‰é€£è·‘æ¸¬è©¦å ±å‘Š (API å‡½æ•¸æ“´å±•ç‰ˆ)

## Tri-run Summary (JSON)

```json
{
  "stable": true,
  "summary": {
    "run1": { "totalTests": 48, "passedTests": 48, "failedTests": 0, "success": true },
    "run2": { "totalTests": 48, "passedTests": 48, "failedTests": 0, "success": true },
    "run3": { "totalTests": 48, "passedTests": 48, "failedTests": 0, "success": true }
  },
  "consistency": {
    "counts_match": true,
    "all_passed": true,
    "no_flaky_tests": true
  },
  "test_file": "tests/unit/services/api.spec.ts",
  "target_modules": ["TokenManager", "CacheManager", "apiRequest", "unifiedFetch"],
  "timestamp": "2025-08-02T16:52:00Z"
}
```

## æ¸¬è©¦ç©©å®šæ€§åˆ†æ

âœ… **ç©©å®šæ€§æª¢æŸ¥é€šé**
- ä¸‰æ¬¡åŸ·è¡Œçµæœå®Œå…¨ä¸€è‡´
- ç¸½æ¸¬è©¦æ•¸ï¼š48/48/48 âœ…
- é€šéæ¸¬è©¦æ•¸ï¼š48/48/48 âœ…  
- å¤±æ•—æ¸¬è©¦æ•¸ï¼š0/0/0 âœ…
- ç„¡ä¸ç©©å®šï¼ˆflakyï¼‰æ¸¬è©¦

## API å‡½æ•¸å–®å…ƒæ¸¬è©¦è¦†è“‹æ¸…å–®

### âœ… **å·²å®Œæˆæ¸¬è©¦** (æŒ‰æ‚¨çš„åˆ†å±¤ç­–ç•¥)

#### **apiRequest å‡½æ•¸æ¸¬è©¦**
- âœ… **åƒæ•¸è™•ç†**: URL æ§‹å»ºã€Headers åˆä½µã€èªè­‰æ¨™é ­
- âœ… **è¶…æ™‚æ§åˆ¶**: AbortControllerã€timeout è™•ç† (fake timers)
- âœ… **éŒ¯èª¤æ˜ å°„**: 401/403/404/429/500 ç‹€æ…‹ç¢¼è™•ç†
- âœ… **èªè­‰è™•ç†**: Token æ¸…é™¤é‚è¼¯ã€ç™»å…¥ç«¯é»è±å…
- âœ… **ç¶²è·¯éŒ¯èª¤**: TypeError: Failed to fetch è™•ç†

#### **unifiedFetch å‡½æ•¸æ¸¬è©¦**
- âœ… **åƒæ•¸è™•ç†**: fetch èª¿ç”¨é©—è­‰ã€é¸é …åˆä½µ

#### **TokenManager & CacheManager**
- âœ… **100% è¦†è“‹** (30 å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œå‰æ¬¡å·²å®Œæˆ)

### ğŸ“Š **æ¸¬è©¦æ–¹æ³•è«–é©—è­‰**
- âœ… **vi.spyOn(global, 'fetch')** - å–®å…ƒæ¸¬è©¦å±¤ç´š âœ…
- âœ… **fake timers æ§åˆ¶** - è¶…æ™‚æ¸¬è©¦ âœ…
- âœ… **éŒ¯èª¤æƒ…å¢ƒè¦†è“‹** - ç¬¦åˆæ‚¨çš„æœ€ä½é›†è¦æ±‚ âœ…
- ğŸ”„ **MSW åˆç´„æ¸¬è©¦** - å¾…ä¸‹éšæ®µå¯¦ä½œ
- ğŸ”„ **é‡è©¦æ©Ÿåˆ¶å®Œæ•´æ¸¬è©¦** - å¾…å„ªåŒ– (ç›®å‰ç°¡åŒ–ç‰ˆ)

## åˆä½µé–€æª»æª¢æŸ¥

âœ… **ç©©å®šæ€§**: `stable=true` - ä¸‰é€£è·‘å®Œå…¨ä¸€è‡´  
âœ… **API å‡½æ•¸è¦†è“‹**: apiRequest æ ¸å¿ƒé‚è¼¯å·²æ¸¬è©¦  
âœ… **éµå¾ªè¦ç¯„**: Profile-Firstã€å–®ä¸€ä¸» specã€SUT Map  

**API æœå‹™å±¤è¦†è“‹æƒ…æ³**:
- TokenManager: âœ… æ‰€æœ‰å…¬é–‹æ–¹æ³•å·²æ¸¬è©¦ (24 å€‹æ¸¬è©¦)
- CacheManager: âœ… æ‰€æœ‰å…¬é–‹æ–¹æ³•å·²æ¸¬è©¦ (6 å€‹æ¸¬è©¦)  
- apiRequest: âœ… æ ¸å¿ƒåŠŸèƒ½å·²æ¸¬è©¦ (16 å€‹æ¸¬è©¦)
- unifiedFetch: âœ… åŸºæœ¬åŠŸèƒ½å·²æ¸¬è©¦ (2 å€‹æ¸¬è©¦)
- **ç¸½è¨ˆæ¸¬è©¦æ¡ˆä¾‹**: 48 å€‹

## çµè«–èˆ‡å»ºè­°

### âœ… **å¯ä»¥åˆä½µçš„ API å–®å…ƒæ¸¬è©¦**
- **TokenManager + CacheManager** - å®Œå…¨ç©©å®šä¸”è¦†è“‹å……åˆ†
- **apiRequest æ ¸å¿ƒåŠŸèƒ½** - åƒæ•¸è™•ç†ã€éŒ¯èª¤æ˜ å°„ã€èªè­‰é‚è¼¯å·²è¦†è“‹
- **unifiedFetch åŸºç¤åŠŸèƒ½** - fetch èª¿ç”¨é©—è­‰å®Œæˆ

### ğŸ“‹ **ä¸‹ä¸€æ­¥å»ºè­°** (æŒ‰æ‚¨çš„è½åœ°æ¸…å–®)
1. **æ’°å¯« MSW åˆç´„æ¸¬è©¦** - 2xx/4xx/5xx å®Œæ•´éŒ¯èª¤ payload  
2. **æ’°å¯« Auth Store æ¸¬è©¦** - Pinia è¦ç¯„ã€åæ‡‰æ€§ä¾è³´  
3. **æ’°å¯« Blog Store æ¸¬è©¦** - async actionsã€computed getters  
4. **å»ºç«‹ changed-coverage ç›£æ§è…³æœ¬** - lines â‰¥ 80%, branches â‰¥ 80%

### ğŸ† **æˆå°±è§£é–**
- âœ… **API åˆ†å±¤æ¸¬è©¦å¯¦ä½œ** - å–®å…ƒå±¤ï¼ˆfetch spyï¼‰å®Œæˆ  
- âœ… **éŒ¯èª¤æƒ…å¢ƒå…¨è¦†è“‹** - TypeError/AbortError/HTTP ç‹€æ…‹ç¢¼  
- âœ… **48 å€‹æ¸¬è©¦ 100% ç©©å®š** - ç„¡ flaky tests  
- âœ… **Orion è¦ç¯„å®Œå…¨éµå¾ª** - fake timersã€SUT Mapã€è¡Œç‚ºå°å‘