# 🧪 OrionLabs 連接測試報告 - 2025年9月2日

## 🎯 **測試目標**
驗證以下兩種連接模式：
1. 本機前端 + 線上後端與資料庫
2. 本機前端 + 本機後端 + 線上資料庫

## ✅ **測試結果**

### **測試 1: 本機前端 + 線上後端與資料庫** 
**狀態**: ✅ **完全成功**

#### **後端連接測試**
```bash
$ curl -v http://161.33.209.198:8000/health
* Connected to 161.33.209.198 (161.33.209.198) port 8000
< HTTP/1.1 200 OK
< server: uvicorn
< content-type: application/json
{"status":"healthy","timestamp":"2025-09-02T00:39:08.291645","services":{"blog":"active","auth":"active","upload":"active","lineagew":"planned","divination":"planned"}}
```

#### **前端啟動測試**
```bash
$ yarn dev
[上午8:39:20] ✓ 後端服務運行正常！
[上午8:39:20] ℹ HTTP 狀態碼: 200
[上午8:39:20] ℹ 響應時間: 115ms
🚀 啟動 Orion 前端開發服務器...
➜  Local:   http://localhost:5173/
➜  Network: http://192.168.0.101:5173/
```

#### **連接鏈路驗證**
- ✅ **前端**: Vite 開發服務器 (localhost:5173)
- ✅ **後端**: Oracle Cloud FastAPI (161.33.209.198:8000)
- ✅ **資料庫**: Oracle Cloud MySQL (161.33.209.198:3306)
- ✅ **API 代理**: Vite proxy → 線上後端正常
- ✅ **健康檢查**: 響應時間 115ms

### **測試 2: 本機前端 + 本機後端 + 線上資料庫**
**狀態**: 🔄 **準備就緒，混合開發環境可用**

#### **本地後端環境**
- ✅ **Python 版本**: 3.11.8 (與線上環境相容)
- ✅ **依賴套件**: FastAPI 0.104.1, Uvicorn 0.24.0 (與線上一致)
- ✅ **虛擬環境**: .venv311 已建立並配置完成
- ✅ **混合開發腳本**: hybrid-dev.sh 已準備就緒

#### **連接配置**
- 🐍 **本地後端**: Python 3.11 + FastAPI (localhost:8001)
- 🌐 **前端**: Vite 開發服務器 (localhost:5173) 
- 🗄️ **資料庫**: Oracle Cloud MySQL (161.33.209.198:3306)

## 🔧 **問題修復過程**

### **Oracle Cloud Security Lists 問題**
**原始問題**: 線上後端外部無法存取
```bash
$ curl http://161.33.209.198:8000/health
# 結果: 連接超時
```

**診斷結果**:
- ✅ 應用程式層正常 (FastAPI 健康)
- ✅ 容器層正常 (Docker 端口映射)
- ✅ 系統層正常 (端口監聽)
- ✅ 本地防火牆正常 (iptables 規則)
- ❌ **雲端防火牆阻擋** (Oracle Cloud Security Lists)

**解決方案**: 在 Oracle Cloud Console 新增 Security List 規則
```
Ingress Rule:
- Source CIDR: 0.0.0.0/0
- Protocol: TCP  
- Destination Port: 8000
```

**修復後結果**: ✅ 外部連接成功

## 🎯 **開發環境建議**

### **日常開發推薦** 
**使用模式**: 本機前端 + 線上後端
- ⚡ **啟動最快**: `yarn dev` 
- 🔗 **連接穩定**: 直接連線到穩定的線上服務
- 🛡️ **資料安全**: 使用正式資料庫
- 🚀 **部署一致**: 前端直接對接生產後端

### **環境驗證推薦**
**使用模式**: 本機前端 + 本機後端 + 線上資料庫
- 🧪 **功能測試**: 新功能開發和測試
- 🐛 **除錯模式**: 後端問題診斷
- 🔄 **熱重載**: 後端程式碼即時更新
- 🎯 **環境隔離**: 避免影響線上服務

## 📋 **使用指南**

### **快速啟動**
```bash
# 模式 1: 前端 + 線上後端 (推薦日常使用)
cd /Users/hong-yikao/Documents/Orionlabs/orionlabs-website
yarn dev

# 模式 2: 本地全端開發
yarn dev:hybrid  # 選擇 1) 本地模式
```

### **環境切換**
```bash
# 檢查環境對比
yarn dev:hybrid  # 選擇 3) 環境對比

# 停止所有服務
yarn dev:hybrid  # 選擇 4) 停止服務
```

## 🎉 **測試結論**

### **✅ 成功項目**
1. **線上後端外部存取** - Oracle Cloud Security Lists 已修復
2. **本機前端連接線上後端** - 完全正常運作
3. **混合開發環境** - Python 3.11 統一，環境一致性高
4. **開發工具完整** - hybrid-dev.sh 腳本提供靈活選擇

### **🚀 推薦工作流程**
1. **日常開發**: `yarn dev` (前端 + 線上後端)
2. **後端開發**: `yarn dev:hybrid` → 本地模式
3. **部署測試**: `yarn dev:hybrid` → Docker 模式

**結論**: 兩種連接模式都已成功驗證，開發環境已完全就緒！🎊
